<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4CAF50">
    <title>متابعة الأدوية</title>
    <link rel="icon" type="image/svg+xml" href="app-icon.svg">
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-152x152.png">
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="icons/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="icons/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="icons/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="icons/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="ios-fix.css">
    <style>
        .quantity-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .quantity-input input[type="number"] {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }

        .quantity-input select {
            width: 100px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #fff;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta name="description" content="تطبيق لمتابعة مواعيد الأدوية والجرعات">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-pills"></i> متابعة الأدوية</h1>
            <div class="header-buttons">
            </div>
        </header>

        <main>
            <!-- قائمة الأدوية -->
            <div class="view-content" id="medicinesView">
                <div class="medicines-list" id="medicinesList">
                    <!-- سيتم إضافة البطاقات هنا عبر JavaScript -->
                </div>
            </div>

            <!-- قسم التقويم -->
            <div class="view-content" id="calendarView" style="display: none;">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h2>تقويم الأدوية</h2>
                        <div class="calendar-nav">
                            <button id="prevMonth" class="btn-secondary"><i class="fas fa-chevron-right"></i></button>
                            <span id="currentMonth"></span>
                            <button id="nextMonth" class="btn-secondary"><i class="fas fa-chevron-left"></i></button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- أيام الأسبوع -->
                        <div class="calendar-weekday">الأحد</div>
                        <div class="calendar-weekday">الإثنين</div>
                        <div class="calendar-weekday">الثلاثاء</div>
                        <div class="calendar-weekday">الأربعاء</div>
                        <div class="calendar-weekday">الخميس</div>
                        <div class="calendar-weekday">الجمعة</div>
                        <div class="calendar-weekday">السبت</div>
                        <!-- سيتم إضافة أيام التقويم هنا -->
                    </div>
                </div>
            </div>

            <!-- قسم التقارير -->
            <div class="view-content" id="reportsView" style="display: none;">
                <div class="reports-container">
                    <h2>تقارير الأدوية</h2>
                    <div class="report-cards">
                        <div class="report-card">
                            <h3>إحصائيات الشهر</h3>
                            <div id="monthlyStats" class="stats-container">
                                <!-- سيتم إضافة الإحصائيات هنا -->
                            </div>
                        </div>
                        <div class="report-card">
                            <h3>الأدوية الأكثر استخداماً</h3>
                            <div id="topMedicines" class="stats-container">
                                <!-- سيتم إضافة الإحصائيات هنا -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- قسم الكميات -->
            <div class="view-content" id="quantityView" style="display: none;">
                <div class="quantity-container">
                    <h2>كميات الأدوية</h2>
                    <div id="medicineQuantityList"></div>
                </div>
            </div>

            <!-- قسم الإعدادات -->
            <div class="view-content" id="settingsView" style="display: none;">
                <div class="settings-container">
                    <div class="settings-header">
                        <h2>الإعدادات</h2>
                    </div>
                    <div class="settings-content">
                        <div class="settings-section">
                            <h3>الأدوية</h3>
                            <div id="medicineSettings" class="medicine-settings">
                                <!-- سيتم إضافة قائمة الأدوية هنا -->
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>المظهر</h3>
                            <div class="settings-item">
                                <span>لون الخلفية</span>
                                <div class="theme-colors">
                                    <button class="theme-color" data-theme="theme-blue">
                                        <i class="fas fa-paint-brush"></i>
                                    </button>
                                    <button class="theme-color" data-theme="theme-purple">
                                        <i class="fas fa-paint-brush"></i>
                                    </button>
                                    <button class="theme-color" data-theme="theme-pink">
                                        <i class="fas fa-paint-brush"></i>
                                    </button>
                                    <button class="theme-color" data-theme="theme-orange">
                                        <i class="fas fa-paint-brush"></i>
                                    </button>
                                    <button class="theme-color" data-theme="theme-green">
                                        <i class="fas fa-paint-brush"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>المساعدة</h3>
                            <div class="help-content">
                                <p>للتواصل مع الدعم الفني:</p>
                                <div class="contact-info">
                                    <i class="fas fa-envelope"></i>
                                    <a href="mailto:buyer997@hotmail.com">buyer997@hotmail.com</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- نموذج إضافة دواء جديد -->
            <div class="modal" id="addMedicineModal">
                <div class="modal-content">
                    <h2>إضافة دواء جديد</h2>
                    <form id="addMedicineForm">
                        <div class="form-group">
                            <label for="medicineName">اسم الدواء</label>
                            <input type="text" id="medicineName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="dosage">الجرعة</label>
                            <input type="text" id="dosage" placeholder="مثال: حبة واحدة" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="frequency">عدد المرات</label>
                            <select id="frequency" required>
                                <option value="daily">يومياً</option>
                                <option value="weekly">أسبوعياً</option>
                                <option value="monthly">شهرياً</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="times">أوقات الجرعات</label>
                            <div id="timesContainer">
                                <input type="time" class="time-input" required>
                                <button type="button" class="btn-secondary add-time">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        


                        <div class="form-group">
                            <label for="notes">ملاحظات</label>
                            <textarea id="notes" rows="3"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="soundEnabled" checked>
                                <span>تفعيل التنبيه الصوتي</span>
                            </label>
                        </div>
                        <div class="form-group sound-options" id="soundOptions">
                            <label for="soundType">نوع التنبيه</label>
                            <select id="soundType" class="sound-select">
                                <option value="beep">صفير</option>
                                <option value="bell">جرس</option>
                                <option value="chime">رنين</option>
                                <option value="ding">جرس قصير</option>
                                <option value="notification">تنبيه</option>
                                <option value="alert">تنبيه مهم</option>
                                <option value="soft">صوت ناعم</option>
                                <option value="melody">لحن</option>
                                <option value="crystal">كريستال</option>
                                <option value="digital">رقمي</option>
                            </select>
                            <button type="button" class="btn-secondary test-sound" onclick="testSound()">
                                <i class="fas fa-play"></i>
                                تجربة الصوت
                            </button>
                        </div>
                        
                        <div class="form-buttons">
                            <button type="submit" class="btn-primary">حفظ</button>
                            <button type="button" class="btn-secondary" id="cancelAdd">إلغاء</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- نموذج الإعدادات -->
            <div class="modal" id="settingsModal">
                <div class="modal-content">
                    <h2>الإعدادات</h2>
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="notificationSound">صوت التنبيه</label>
                            <select id="notificationSound">
                                <option value="notification.mp3">الصوت الافتراضي</option>
                                <option value="notification2.mp3">صوت 2</option>
                                <option value="notification3.mp3">صوت 3</option>
                            </select>
                            <button type="button" class="btn-secondary" id="testSound">
                                <i class="fas fa-play"></i> تجربة الصوت
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label for="backgroundColor">لون الخلفية</label>
                            <input type="color" id="backgroundColor" value="#ffffff">
                        </div>
                        
                        <div class="form-buttons">
                            <button type="submit" class="btn-primary">حفظ</button>
                            <button type="button" class="btn-secondary" id="cancelSettings">إلغاء</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- زر الإضافة العائم -->
            <button id="addMedicineBtn" class="floating-add-btn">
                <i class="fas fa-plus"></i>
            </button>
        </main>

        <!-- شريط التنقل السفلي -->
        <nav class="bottom-nav">
            <a href="#" class="bottom-nav-item active" data-view="medicinesView">
                <i class="fas fa-pills"></i>
                <span>الأدوية</span>
            </a>

            <a href="#" class="bottom-nav-item" data-view="reportsView">
                <i class="fas fa-chart-bar"></i>
                <span>التقارير</span>
            </a>
            <a href="#" class="bottom-nav-item" data-view="quantityView">
                <i class="fas fa-pills"></i>
                <span>الكميات</span>
            </a>
            <a href="#" class="bottom-nav-item" data-view="settingsView">
                <i class="fas fa-cog"></i>
                <span>الإعدادات</span>
            </a>
        </nav>
    </div>

    <script src="script.js"></script>
    <script>
        // تسجيل Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js', {
                    scope: '/medicine-reminder-app/'
                }).then(registration => {
                    console.log('ServiceWorker registered successfully');
                }).catch(error => {
                    console.log('ServiceWorker registration failed:', error);
                });
            });
        }

        // منع السحب للتحديث على iOS
        let touchStartY = 0;
        document.addEventListener('touchstart', e => {
            touchStartY = e.touches[0].clientY;
        }, { passive: false });

        document.addEventListener('touchmove', e => {
            const touchY = e.touches[0].clientY;
            const touchDiff = touchStartY - touchY;
            
            // منع السحب للأسفل في بداية الصفحة
            if (window.scrollY === 0 && touchDiff < 0) {
                e.preventDefault();
            }
            
            // منع السحب للأعلى في نهاية الصفحة
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight && touchDiff > 0) {
                e.preventDefault();
            }
        }, { passive: false });

        // منع تكبير الصفحة بالضغط المزدوج
        document.addEventListener('gesturestart', e => {
            e.preventDefault();
        });

        // طلب إذن التنبيهات عند بدء التطبيق
        if ('Notification' in window) {
            Notification.requestPermission();
        }
    </script>
</body>
</html>
